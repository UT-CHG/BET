

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Example: Nonlinear Map with Uniform Sampling &mdash; BET 2.1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Example: Validation" href="validation.html" />
    <link rel="prev" title="Example: Linear Map Choose QoIs (volume / bin_ratio)" href="linear_volume_binratio.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> BET
          

          
          </a>

          
            
            
              <div class="version">
                2.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parallel.html">Parallel</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../examples_overview.html">Some References and Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../examples_overview.html#validation-example">Validation example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples_overview.html#linear-map-example">Linear Map Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples_overview.html#non-linear-map-example">Non-Linear Map Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples_overview.html#fenics-example-serial-bet-and-serial-model">FEniCS Example (serial BET and serial model)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples_overview.html#adcirc-on-an-idealized-inlet-examples-and-adaptive-sampling">ADCIRC on an Idealized Inlet Examples and Adaptive Sampling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples_overview.html#contaminant-transport-example">Contaminant Transport Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples_overview.html#choosing-optimal-qois-examples">Choosing Optimal QoIs Examples</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../examples_overview.html#list-of-all-examples">List of all examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="FEniCS.html">Example: FEniCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="FEniCSMultipleSerial.html">Example: Multiple Serial FEniCS</a></li>
<li class="toctree-l3"><a class="reference internal" href="Q_1D.html">Example: Estimate the parameter space probabiliy density with  a 1D data space</a></li>
<li class="toctree-l3"><a class="reference internal" href="Q_2D.html">Example: Estimate the parameter space probabiliy density with  a 2D data space</a></li>
<li class="toctree-l3"><a class="reference internal" href="Q_3D.html">Example: Estimate the parameter space probabiliy density with  a 3D data space</a></li>
<li class="toctree-l3"><a class="reference internal" href="chooseOptQoIs_2d.html">Example: Optimizing space-time measurements of temperature on a thin plate</a></li>
<li class="toctree-l3"><a class="reference internal" href="contaminantTransport.html">Example: Concentration of Contaminant in Wells Based on Transport Parameters</a></li>
<li class="toctree-l3"><a class="reference internal" href="domains2D.html">Example: Generalized Chains with a 2,2-dimensional data,parameter space</a></li>
<li class="toctree-l3"><a class="reference internal" href="domains3D.html">Example: Generalized Chains with a 3,3-dimensional data,parameter space</a></li>
<li class="toctree-l3"><a class="reference internal" href="fromfile2D.html">Example: Batch Adaptive Sampling (2-to-2 example)</a></li>
<li class="toctree-l3"><a class="reference internal" href="fromfile3D.html">Example: Batch Adaptive Sampling (3-to-3 example)</a></li>
<li class="toctree-l3"><a class="reference internal" href="linearMapUniformSampling.html">Example: Linear Map with Uniform Sampling</a></li>
<li class="toctree-l3"><a class="reference internal" href="linear_measure_binratio.html">Example: Linear Map Choose QoIs to minimize scale of inverses in measure</a></li>
<li class="toctree-l3"><a class="reference internal" href="linear_measure_binsize_large.html">Example: Linear Map Choose QoIs (volume / bin_size / large)</a></li>
<li class="toctree-l3"><a class="reference internal" href="linear_volume_binratio.html">Example: Linear Map Choose QoIs (volume / bin_ratio)</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Example: Nonlinear Map with Uniform Sampling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#step-0-setting-up-the-environment">Step (0): Setting up the environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-1-define-interface-to-the-model">Step (1): Define interface to the model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-2-describe-and-sample-the-input-space">Step (2): Describe and sample the input space</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-3-generate-qoi-samples">Step (3): Generate QoI samples</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-4-describe-the-data-distribution">Step (4): Describe the data distribution</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-5-solve-the-stochastic-inverse-problem">Step (5): Solve the stochastic inverse problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="#step-6-optional-post-processing">Step (6) [Optional]: Post-processing</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="validation.html">Example: Validation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">bet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../todo_list.html">Todo List</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">BET</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../examples_overview.html">Some References and Examples</a> &raquo;</li>
        
      <li>Example: Nonlinear Map with Uniform Sampling</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/examples/example_rst_files/nonlinearMapUniformSampling.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="example-nonlinear-map-with-uniform-sampling">
<span id="nonlinearmap"></span><h1>Example: Nonlinear Map with Uniform Sampling<a class="headerlink" href="#example-nonlinear-map-with-uniform-sampling" title="Permalink to this headline">¶</a></h1>
<p>We will walk through the following <a class="reference external" href="https://github.com/UT-CHG/BET/blob/master/examples/nonlinearMap/nonlinearMapUniformSampling.py">example</a>.
This example generates uniform samples in a 2D input parameter space
and evaluates a nonlinear map to either a 1D or 2D output data space.
The purpose of this example is to study the effect of using different
maps to solve the stochastic inverse problem.
The nonlinear map is defined as either one or two quantities of
interest (QoI) which are defined as spatial observations of the
solution to the elliptic PDE</p>
<div class="math notranslate nohighlight">
\begin{cases}
    -\nabla \cdot (A(\lambda)\cdot\nabla u) &amp;= f(x,y;\lambda), \ (x,y)\in\Omega, \\
    u|_{\partial \Omega} &amp;= 0,
\end{cases}</div><p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}A(\lambda)=\left(\begin{array}{cc}
1/\lambda_1^2 &amp; 0 \\ 0 &amp; 1/\lambda_2^2 \end{array}\right),\end{split}\]</div>
<div class="math notranslate nohighlight">
\[f(x,y;\lambda) = \pi^2 \sin(\pi x\lambda_1)\sin(\pi y \lambda_2),\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\Omega=[0,1]\times[0,1].\]</div>
<p>The user can change the number and placement of the QoI by editing
this information in <a class="reference external" href="https://github.com/UT-CHG/BET/blob/master/examples/nonlinearMap/myModel.py">myModel</a>.
A reference parameter is used to define a reference QoI datum
and a uniform probability measure is defined on a small box
centered at this datum.
The measure on the data space is discretized either randomly
or deterministically, and this discretized measure is then
inverted by BET to determine a probability measure on the
parameter space whose support contains the measurable sets
of probable parameters.
We often use emulation to estimate the measures of sets when
random sampling is used.
1D and 2D marginals are calculated, smoothed, and plotted.</p>
<p>The actual process is quite simple requiring a total of 5 steps
to solve the stochastic inverse problem with BET excluding any
post-processing
the user may want.
In general the user will probably not write code with various
options as was done here for pedagogical purposes.
We break down the actual example included with BET step-by-step
below, but first, to showcase the overall simplicitly, we show
the “entire” code (omitting setting the environment,
post-processing, and commenting) required
for solving
the stochastic inverse problem using some default options:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">bsam</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="n">my_model</span><span class="p">)</span>

<span class="n">input_samples</span> <span class="o">=</span> <span class="n">samp</span><span class="o">.</span><span class="n">sample_set</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">input_samples</span><span class="o">.</span><span class="n">set_domain</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span>
                               <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]]))</span>
<span class="n">input_samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">regular_sample_set</span><span class="p">(</span><span class="n">input_samples</span><span class="p">,</span> <span class="n">num_samples_per_dim</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
<span class="n">input_samples</span><span class="o">.</span><span class="n">estimate_volume_mc</span><span class="p">()</span>

<span class="n">my_discretization</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">compute_QoI_and_create_discretization</span><span class="p">(</span><span class="n">input_samples</span><span class="p">)</span>

<span class="n">param_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">])</span>
<span class="n">Q_ref</span> <span class="o">=</span>  <span class="n">my_model</span><span class="p">(</span><span class="n">param_ref</span><span class="p">)</span>
<span class="n">simpleFunP</span><span class="o">.</span><span class="n">regular_partition_uniform_distribution_rectangle_scaled</span><span class="p">(</span>
    <span class="n">data_set</span><span class="o">=</span><span class="n">my_discretization</span><span class="p">,</span> <span class="n">Q_ref</span><span class="o">=</span><span class="n">Q_ref</span><span class="p">,</span> <span class="n">rect_scale</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
    <span class="n">cells_per_dimension</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">calculateP</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="n">my_discretization</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="step-0-setting-up-the-environment">
<h2>Step (0): Setting up the environment<a class="headerlink" href="#step-0-setting-up-the-environment" title="Permalink to this headline">¶</a></h2>
<p>Import the necessary modules:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">bet.calculateP.simpleFunP</span> <span class="k">as</span> <span class="nn">simpleFunP</span>
<span class="kn">import</span> <span class="nn">bet.calculateP.calculateP</span> <span class="k">as</span> <span class="nn">calculateP</span>
<span class="kn">import</span> <span class="nn">bet.postProcess.plotP</span> <span class="k">as</span> <span class="nn">plotP</span>
<span class="kn">import</span> <span class="nn">bet.postProcess.plotDomains</span> <span class="k">as</span> <span class="nn">plotD</span>
<span class="kn">import</span> <span class="nn">bet.sample</span> <span class="k">as</span> <span class="nn">samp</span>
<span class="kn">import</span> <span class="nn">bet.sampling.basicSampling</span> <span class="k">as</span> <span class="nn">bsam</span>
</pre></div>
</div>
</div>
<div class="section" id="step-1-define-interface-to-the-model">
<h2>Step (1): Define interface to the model<a class="headerlink" href="#step-1-define-interface-to-the-model" title="Permalink to this headline">¶</a></h2>
<p>Import the Python script interface to the Python <a class="reference external" href="https://github.com/UT-CHG/BET/blob/master/examples/nonlinearMap/myModel.py">model</a>
that takes as input a numpy array of model input parameter samples,
generated from the sampler (see below), evaluates the model to
generate QoI samples, and returns the QoI samples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myModel</span> <span class="k">import</span> <span class="n">my_model</span>
</pre></div>
</div>
<p>Define the sampler that will be used to create the discretization
object, which is the fundamental object used by BET to compute
solutions to the stochastic inverse problem.
The sampler and my_model is the interface of BET to the model,
and it allows BET to create input/output samples of the model:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sampler</span> <span class="o">=</span> <span class="n">bsam</span><span class="o">.</span><span class="n">sampler</span><span class="p">(</span><span class="n">my_model</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="suggested-changes-for-user-1">
<h3>Suggested changes for user (1)<a class="headerlink" href="#suggested-changes-for-user-1" title="Permalink to this headline">¶</a></h3>
<p>Go into the file <a class="reference external" href="https://github.com/UT-CHG/BET/blob/master/examples/nonlinearMap/myModel.py">myModel.py</a>
and find the following chunk of code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">QoI_num</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Specify the spatial points to take measurements of solution defining the QoI</span>
<span class="k">if</span> <span class="n">QoI_num</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y1</span><span class="p">])</span>
<span class="k">else</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="mf">0.15</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="mf">0.15</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="mf">0.25</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>
</pre></div>
</div>
<p>try different choices of QoI by changing the <code class="docutils literal notranslate"><span class="pre">x1</span></code>, <code class="docutils literal notranslate"><span class="pre">y1</span></code>, and/or,
<code class="docutils literal notranslate"><span class="pre">x2</span></code>, <code class="docutils literal notranslate"><span class="pre">y2</span></code> (if you have set  <code class="docutils literal notranslate"><span class="pre">QoI_num</span> <span class="pre">=</span> <span class="pre">2</span></code>) in order to “optimize”
the QoI so that the solution to the stochastic inverse problem is a small
region of high probability centered around the reference parameter (see
below for more information on choosing the reference parameter in the main
script).</p>
<p>It is a good idea to start with <code class="docutils literal notranslate"><span class="pre">QoI_num</span> <span class="pre">=</span> <span class="pre">1</span></code> and systematically vary
the
<code class="docutils literal notranslate"><span class="pre">x1</span></code> and <code class="docutils literal notranslate"><span class="pre">y1</span></code> values to find QoI with contour structures (as inferred
through the 2D marginal plots) that are nearly orthogonal.</p>
<p>Some interesting pairs of QoI to compare are:</p>
<ul class="simple">
<li><p>(x1,y1)=(0.5,0.5) and (x2,y2)=(0.25,0.25)</p></li>
<li><p>(x1,y1)=(0.5,0.5) and (x2,y2)=(0.15,0.15)</p></li>
<li><p>(x1,y1)=(0.5,0.5) and (x2,y2)=(0.25,0.15)</p></li>
</ul>
</div>
</div>
<div class="section" id="step-2-describe-and-sample-the-input-space">
<h2>Step (2): Describe and sample the input space<a class="headerlink" href="#step-2-describe-and-sample-the-input-space" title="Permalink to this headline">¶</a></h2>
<p>Initialize the (2-dimensional) input parameter sample set object
and set the parameter domain (chosen here so that the QoI maps
have interesting features):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">input_samples</span> <span class="o">=</span> <span class="n">samp</span><span class="o">.</span><span class="n">sample_set</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">input_samples</span><span class="o">.</span><span class="n">set_domain</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">],</span>
                           <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">]]))</span>
</pre></div>
</div>
<div class="section" id="suggested-changes-for-user-2">
<h3>Suggested changes for user (2)<a class="headerlink" href="#suggested-changes-for-user-2" title="Permalink to this headline">¶</a></h3>
<p>Try with and without random sampling.</p>
<p>If using random sampling, try <code class="docutils literal notranslate"><span class="pre">num_samples</span> <span class="pre">=</span> <span class="pre">1E3</span></code> and
<code class="docutils literal notranslate"><span class="pre">num_samples</span> <span class="pre">=</span> <span class="pre">1E4</span></code>.
See what happens when <code class="docutils literal notranslate"><span class="pre">num_samples</span> <span class="pre">=</span> <span class="pre">1E2</span></code>.
Try using <code class="docutils literal notranslate"><span class="pre">'lhs'</span></code> instead of <code class="docutils literal notranslate"><span class="pre">'random'</span></code> in the random_sample_set.</p>
<p>If using regular sampling, try different numbers of samples
per dimension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">randomSampling</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="n">randomSampling</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">input_samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">random_sample_set</span><span class="p">(</span><span class="s1">&#39;random&#39;</span><span class="p">,</span> <span class="n">input_samples</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mf">1E4</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">input_samples</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">regular_sample_set</span><span class="p">(</span><span class="n">input_samples</span><span class="p">,</span> <span class="n">num_samples_per_dim</span><span class="o">=</span><span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="section" id="suggested-changes-for-user-3">
<h3>Suggested changes for user (3)<a class="headerlink" href="#suggested-changes-for-user-3" title="Permalink to this headline">¶</a></h3>
<p>A standard Monte Carlo (MC) assumption is that every Voronoi cell
has the same volume. If a regular grid of samples was used, then
the standard MC assumption is true.</p>
<p>See what happens if the MC assumption is not assumed to be true, and
if different numbers of points are used to estimate the volumes of
the Voronoi cells:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">MC_assumption</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">MC_assumption</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
    <span class="n">input_samples</span><span class="o">.</span><span class="n">estimate_volume</span><span class="p">(</span><span class="n">n_mc_points</span><span class="o">=</span><span class="mf">1E5</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">input_samples</span><span class="o">.</span><span class="n">estimate_volume_mc</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-3-generate-qoi-samples">
<h2>Step (3): Generate QoI samples<a class="headerlink" href="#step-3-generate-qoi-samples" title="Permalink to this headline">¶</a></h2>
<p>Create the discretization object holding all the input (parameter) samples
and output (QoI) samples using the sampler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">my_discretization</span> <span class="o">=</span> <span class="n">sampler</span><span class="o">.</span><span class="n">compute_QoI_and_create_discretization</span><span class="p">(</span><span class="n">input_samples</span><span class="p">,</span>
                                           <span class="n">savefile</span> <span class="o">=</span> <span class="s1">&#39;NonlinearExample.txt.gz&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>At this point, all of the model information has been extracted for BET
(with the possibly exception of evaluating the model to generate a
reference QoI datum or a distribution of the QoI), so the model is no
longer required for evaluation.
The user could do Steps (0)-(3) in a separate script, and then simply load
the discretization object as part of a separate BET script that does the
remaining steps.
When the model is expensive to evaluate, this is an attractive option
since we can now solve the stochastic inverse problem (with many
different distributions defined on the data space) without ever
having to re-solve the model (so long as we are happy with the resolution
provided by the current discretization of the parameter and data spaces).</p>
</div>
<div class="section" id="step-4-describe-the-data-distribution">
<h2>Step (4): Describe the data distribution<a class="headerlink" href="#step-4-describe-the-data-distribution" title="Permalink to this headline">¶</a></h2>
<p>This problem is nominally a “parameter identification under uncertainty”
problem.
Thus, we take a reference QoI datum (from one more model solve), and
define a distribution “around” this datum.</p>
<div class="section" id="suggested-changes-for-user-4">
<h3>Suggested changes for user (4)<a class="headerlink" href="#suggested-changes-for-user-4" title="Permalink to this headline">¶</a></h3>
<p>Try different reference parameters that produce different
reference QoI data.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">param_ref</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">])</span>
<span class="n">Q_ref</span> <span class="o">=</span>  <span class="n">my_model</span><span class="p">(</span><span class="n">param_ref</span><span class="p">)</span>
</pre></div>
</div>
<p>Use the reference samples and discretization to generate plots (this
is completely optional):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plotD</span><span class="o">.</span><span class="n">scatter_2D</span><span class="p">(</span><span class="n">input_samples</span><span class="p">,</span> <span class="n">ref_sample</span> <span class="o">=</span> <span class="n">param_ref</span><span class="p">,</span>
                                 <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;nonlinearMapParameterSamples.eps&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">Q_ref</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">plotD</span><span class="o">.</span><span class="n">show_data_domain_2D</span><span class="p">(</span><span class="n">my_discretization</span><span class="p">,</span> <span class="n">Q_ref</span> <span class="o">=</span> <span class="n">Q_ref</span><span class="p">,</span> <span class="n">file_extension</span><span class="o">=</span><span class="s2">&quot;eps&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="suggested-changes-for-user-5">
<h3>Suggested changes for user (5)<a class="headerlink" href="#suggested-changes-for-user-5" title="Permalink to this headline">¶</a></h3>
<p>Try different ways of discretizing the probability measure on the data
space defined as a uniform
probability measure on a rectangle centered at Q_ref whose
size is determined by scaling the circumscribing box of the data space:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">randomDataDiscretization</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="n">randomDataDiscretization</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
    <span class="n">simpleFunP</span><span class="o">.</span><span class="n">regular_partition_uniform_distribution_rectangle_scaled</span><span class="p">(</span>
        <span class="n">data_set</span><span class="o">=</span><span class="n">my_discretization</span><span class="p">,</span> <span class="n">Q_ref</span><span class="o">=</span><span class="n">Q_ref</span><span class="p">,</span> <span class="n">rect_scale</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
        <span class="n">cells_per_dimension</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">simpleFunP</span><span class="o">.</span><span class="n">uniform_partition_uniform_distribution_rectangle_scaled</span><span class="p">(</span>
        <span class="n">data_set</span><span class="o">=</span><span class="n">my_discretization</span><span class="p">,</span> <span class="n">Q_ref</span><span class="o">=</span><span class="n">Q_ref</span><span class="p">,</span> <span class="n">rect_scale</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
        <span class="n">M</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">num_d_emulate</span><span class="o">=</span><span class="mf">1E5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="step-5-solve-the-stochastic-inverse-problem">
<h2>Step (5): Solve the stochastic inverse problem<a class="headerlink" href="#step-5-solve-the-stochastic-inverse-problem" title="Permalink to this headline">¶</a></h2>
<p>Calculate probablities on the parameter space (which are stored within
the discretization object):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">calculateP</span><span class="o">.</span><span class="n">prob</span><span class="p">(</span><span class="n">my_discretization</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="step-6-optional-post-processing">
<h2>Step (6) [Optional]: Post-processing<a class="headerlink" href="#step-6-optional-post-processing" title="Permalink to this headline">¶</a></h2>
<p>There are ways to determine “optimal” smoothing parameters (e.g., see CV, GCV,
and other similar methods), but we have not incorporated these into the code
as lower-dimensional marginal plots generally have limited value in understanding
the structure of a high dimensional non-parametric probability measure.</p>
<p>The user may want to change <code class="docutils literal notranslate"><span class="pre">nbins</span></code> or <code class="docutils literal notranslate"><span class="pre">sigma</span></code> in the <code class="docutils literal notranslate"><span class="pre">plotP.*</span></code> inputs
(which influences the
kernel density estimation with smaller values of <code class="docutils literal notranslate"><span class="pre">sigma</span></code> implying a density
estimate that
looks more like a histogram and larger values smoothing out the values
more).</p>
<p>In general, the user will have to tune these for any given problem especially
when looking at marginals of higher-dimensional problems with parameter ranges
that have disparate scales (assuming the parameters were not first normalized
as part of a “un-dimensionalization” of the space, which is highly encouraged):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">marginals2D</span><span class="p">)</span> <span class="o">=</span> <span class="n">plotP</span><span class="o">.</span><span class="n">calculate_2D_marginal_probs</span><span class="p">(</span><span class="n">input_samples</span><span class="p">,</span>
                                                                                                                <span class="n">nbins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

<span class="n">marginals2D</span> <span class="o">=</span> <span class="n">plotP</span><span class="o">.</span><span class="n">smooth_marginals_2D</span><span class="p">(</span><span class="n">marginals2D</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plotP</span><span class="o">.</span><span class="n">plot_2D_marginal_probs</span><span class="p">(</span><span class="n">marginals2D</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">input_samples</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;nomlinearMap&quot;</span><span class="p">,</span>
                                                         <span class="n">lam_ref</span> <span class="o">=</span> <span class="n">param_ref</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="s2">&quot;.eps&quot;</span><span class="p">,</span> <span class="n">plot_surface</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="n">marginals1D</span><span class="p">)</span> <span class="o">=</span> <span class="n">plotP</span><span class="o">.</span><span class="n">calculate_1D_marginal_probs</span><span class="p">(</span><span class="n">input_samples</span><span class="p">,</span>
                                                                                                                <span class="n">nbins</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

<span class="n">marginals1D</span> <span class="o">=</span> <span class="n">plotP</span><span class="o">.</span><span class="n">smooth_marginals_1D</span><span class="p">(</span><span class="n">marginals1D</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plotP</span><span class="o">.</span><span class="n">plot_1D_marginal_probs</span><span class="p">(</span><span class="n">marginals1D</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">input_samples</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;nonlinearMap&quot;</span><span class="p">,</span>
                                                         <span class="n">lam_ref</span> <span class="o">=</span> <span class="n">param_ref</span><span class="p">,</span> <span class="n">file_extension</span> <span class="o">=</span> <span class="s2">&quot;.eps&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="validation.html" class="btn btn-neutral float-right" title="Example: Validation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="linear_volume_binratio.html" class="btn btn-neutral float-left" title="Example: Linear Map Choose QoIs (volume / bin_ratio)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, The BET Development Team (Lindley Graham, Steven Mattis, Troy Butler, Scott Walsh, Michael Pilosov)
      <span class="lastupdated">
        Last updated on Jul 30, 2019.
      </span>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>